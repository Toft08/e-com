<div class="profile-container">
  <!-- Header with User Info -->
  <div class="profile-header">
    <div class="user-info">
      <div class="avatar-section">
        <div class="avatar" *ngIf="!avatarUrl">{{ getInitials() }}</div>
        <img *ngIf="avatarUrl" [src]="avatarUrl" alt="Profile avatar" class="avatar-image" />
        <div class="avatar-actions" *ngIf="isSeller()">
          <input
            type="file"
            #avatarFileInput
            accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
            (change)="onAvatarFileSelected($event)"
            class="file-input-hidden"
          />
          <button
            class="btn-avatar-action"
            (click)="avatarFileInput.click()"
            [disabled]="isUploadingAvatar"
          >
            {{ avatarUrl ? 'üì∑' : '‚ûï' }}
          </button>
          <button
            *ngIf="avatarUrl"
            class="btn-avatar-action btn-delete"
            (click)="deleteAvatar()"
            [disabled]="isUploadingAvatar"
          >
            üóëÔ∏è
          </button>
        </div>
        <div *ngIf="isUploadingAvatar" class="avatar-loading">Uploading...</div>
        <div *ngIf="avatarError" class="avatar-error">{{ avatarError }}</div>
      </div>
      <div class="user-details">
        <h1>{{ currentUser?.name }}</h1>
        <p class="email">{{ currentUser?.email }}</p>
        <span class="role-badge" [ngClass]="'role-' + currentUser?.role">
          {{ currentUser?.role === 'seller' ? 'Seller' : 'Buyer' }}
        </span>
      </div>
    </div>
  </div>

  <!-- Seller View: Products for Sale -->
  <div *ngIf="isSeller()" class="seller-section">
    <div class="section-header">
      <h2>My Products for Sale</h2>
      <a routerLink="/seller/dashboard" class="btn btn-primary">Manage Products</a>
    </div>

    <div *ngIf="isLoading" class="loading">Loading your products...</div>

    <div *ngIf="!isLoading && sellerProducts.length === 0" class="empty-state">
      <p>You haven't listed any products yet.</p>
      <a routerLink="/seller/dashboard" class="btn btn-primary">Create Your First Product</a>
    </div>

    <div *ngIf="!isLoading && sellerProducts.length > 0" class="products-grid">
      <div *ngFor="let product of sellerProducts" class="product-card">
        <div class="product-image">
          <app-image-slider
            *ngIf="getProductImages(product.id!).length > 0"
            [images]="getProductImages(product.id!)"
            [alt]="product.name"
          ></app-image-slider>
          <div *ngIf="getProductImages(product.id!).length === 0" class="no-image">No Image</div>
        </div>
        <div class="product-info">
          <h3>{{ product.name }}</h3>
          <p class="description">{{ product.description | slice : 0 : 60 }}...</p>
          <div class="product-meta">
            <span class="price">${{ product.price | number : '1.2-2' }}</span>
            <span class="quality">Quality: {{ product.quality }}/5</span>
          </div>
          <div class="product-actions">
            <a
              [routerLink]="['/seller/dashboard']"
              [queryParams]="{ productId: product.id }"
              class="btn btn-sm btn-secondary"
            >
              Edit
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Buyer View: Shopping Cart -->
  <div *ngIf="isBuyer()" class="buyer-section">
    <div class="section-header">
      <h2>My Shopping Cart</h2>
      <a routerLink="/products" class="btn btn-primary">Continue Shopping</a>
    </div>

    <div *ngIf="cart.items.length === 0" class="empty-state">
      <p>Your shopping cart is empty.</p>
      <a routerLink="/products" class="btn btn-primary">Browse Products</a>
    </div>

    <div *ngIf="cart.items.length > 0" class="cart-section">
      <table class="cart-table">
        <thead>
          <tr>
            <th>Product</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Total</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of cart.items" class="cart-item">
            <td class="product-name">{{ item.productName }}</td>
            <td class="price">${{ item.price | number : '1.2-2' }}</td>
            <td class="quantity">
              <input
                type="number"
                min="1"
                [value]="item.quantity"
                (change)="updateQuantity(item.productId, $event)"
                class="quantity-input"
              />
            </td>
            <td class="total">${{ item.price * item.quantity | number : '1.2-2' }}</td>
            <td class="action">
              <button (click)="removeFromCart(item.productId)" class="btn btn-sm btn-danger">
                Remove
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="cart-summary">
        <div class="summary-row">
          <span class="label">Subtotal:</span>
          <span class="value">${{ cart.total | number : '1.2-2' }}</span>
        </div>
        <div class="summary-row">
          <span class="label">Shipping:</span>
          <span class="value">$0.00</span>
        </div>
        <div class="summary-row total-row">
          <span class="label">Total:</span>
          <span class="value">${{ cart.total | number : '1.2-2' }}</span>
        </div>
        <button class="btn btn-primary btn-checkout">Proceed to Checkout</button>
      </div>
    </div>
  </div>
</div>
